<!DOCTYPE html>
<html>

<head>
    <title>Processing...</title>
</head>

<body style="text-align:center;font-family:sans-serif;margin-top:50px;">

    <h2 id="title">Processing your file...</h2>

    <!-- Real progress bar -->
    <div id="progressBox" style="width:50%; margin:auto; background:#eee; border-radius:6px; display:none;">
        <div id="bar" style="height:30px; width:0%; background:#4caf50; border-radius:6px;"></div>
    </div>
    <p id="percent"></p>

    <!-- Spinner -->
    <div id="spinner" style="margin-top:30px; font-size:18px; display:none;">
        ‚è≥ Please wait...
    </div>

    <script>
        const jobId = "{{ job_id }}";

        function poll() {
            fetch("/progress/" + jobId)
                .then(r => r.json())
                .then(data => {
                    const mode = data.mode;

                    if (mode === "video") {
                        document.getElementById("spinner").style.display = "none";
                        document.getElementById("progressBox").style.display = "block";

                        let p = data.progress || 0;
                        document.getElementById("bar").style.width = p + "%";
                        document.getElementById("percent").innerText = p + "%";

                        if (p >= 100) {
                            window.location.href = "/download/" + data.output;
                            return;
                        }
                    }

                    else if (mode === "loading") {
                        document.getElementById("progressBox").style.display = "none";
                        document.getElementById("spinner").style.display = "block";
                    }

                    else if (mode === "done") {
                        window.location.href = "/download/" + data.output;
                        return;
                    }

                    setTimeout(poll, 700);
                })
                .catch(() => setTimeout(poll, 1000));
        }

        poll();
    </script>

</body>

</html>